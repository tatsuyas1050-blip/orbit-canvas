<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿç©ºæƒ…å ±å±€ - ç®¡ç†ç”»é¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/base.css">
    <style>
        /* ç®¡ç†ç”»é¢å°‚ç”¨ã®ç°¡æ˜“ã‚¹ã‚¿ã‚¤ãƒ« */
        body { padding: 2rem; max-width: 800px; margin: 0 auto; background-color: #111; color: #fff; }
        h2 { border-bottom: 1px solid #444; padding-bottom: 0.5rem; margin-top: 2rem; color: var(--accent-gold); }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: #aaa; }
        input, select, textarea {
            width: 100%; padding: 10px; background: rgba(255,255,255,0.1);
            border: 1px solid #444; color: #fff; border-radius: 4px; font-family: inherit;
        }
        button {
            background: var(--accent-gold); color: #000; border: none; padding: 10px 20px;
            cursor: pointer; font-weight: bold; border-radius: 4px; margin-top: 10px;
        }
        button:hover { opacity: 0.8; }
        
        /* ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .event-item {
            background: rgba(255,255,255,0.05); border: 1px solid #333;
            padding: 1rem; margin-bottom: 1rem; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .delete-btn { background: #ff4444; color: white; margin: 0; padding: 5px 10px; font-size: 0.8rem; }
    </style>
</head>
<body style="display:none;" id="admin-body">

    <h1>ğŸ› ï¸ æ˜Ÿç©ºæƒ…å ±å±€ ç®¡ç†ãƒšãƒ¼ã‚¸</h1>
    <p style="font-size:0.9rem; color:#888;">ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ãƒ»å‰Šé™¤ãŒã§ãã¾ã™ã€‚</p>
    <a href="events.html" style="color:white; margin-bottom:20px; display:inline-block;">â† æƒ…å ±å±€ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>

    <section>
        <h2>æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²</h2>
        <div id="add-form">
            <div class="form-group">
                <label>ã‚¤ãƒ™ãƒ³ãƒˆå (Title)</label>
                <input type="text" id="inp-title" placeholder="ä¾‹: ãµãŸã”åº§æµæ˜Ÿç¾¤">
            </div>
            
            <div class="form-group">
                <label>ã‚¿ã‚¤ãƒ— (Type)</label>
                <select id="inp-type">
                    <option value="star">å¤©æ–‡ç¾è±¡ (Star)</option>
                    <option value="rocket">ãƒ­ã‚±ãƒƒãƒˆ (Rocket)</option>
                </select>
            </div>

            <div class="form-group">
                <label>æ—¥ä»˜ (Date)</label>
                <input type="date" id="inp-date">
            </div>

            <div class="form-group">
                <label>æ™‚é–“ (Time)</label>
                <input type="text" id="inp-time" placeholder="ä¾‹: 22:00é ƒ">
            </div>

            <div class="form-group">
                <label>è©³ç´° (Description)</label>
                <textarea id="inp-desc" rows="3" placeholder="è©³ç´°ãªèª¬æ˜ã‚’å…¥åŠ›..."></textarea>
            </div>

            <button onclick="addEvent()">ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹</button>
        </div>
    </section>

    <section>
        <h2>ç™»éŒ²æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h2>
        <div id="admin-list">èª­ã¿è¾¼ã¿ä¸­...</div>
    </section>

    <script type="module">
        import { Amplify } from 'aws-amplify';
        import { generateClient } from 'aws-amplify/data';
        import outputs from './amplify_outputs.json';

        // ç°¡æ˜“ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ (ã“ã“ã‚’å¤‰æ›´ã—ã¦å¥½ããªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã—ã¦ãã ã•ã„)
        const ADMIN_PASS = "admin1234";

        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
        const inputPass = prompt("ç®¡ç†ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:");
        if (inputPass === ADMIN_PASS) {
            document.getElementById('admin-body').style.display = 'block';
            initApp();
        } else {
            alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚");
            window.location.href = "index.html";
        }

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
        Amplify.configure(outputs);
        const client = generateClient();
        const listEl = document.getElementById('admin-list');

        function initApp() {
            fetchList();
            
            // é–¢æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹(HTMLã®onclickã‹ã‚‰å‘¼ã¶ãŸã‚)
            window.addEvent = addEvent;
            window.deleteEvent = deleteEvent;
        }

        // --- 1. ä¸€è¦§å–å¾— ---
        async function fetchList() {
            listEl.innerHTML = 'èª­ã¿è¾¼ã¿ä¸­...';
            try {
                // æ—¥ä»˜é †ã«ä¸¦ã¹æ›¿ãˆãŸã„å ´åˆã¯æœ¬å½“ã¯sortãŒå¿…è¦ã§ã™ãŒã€ä¸€æ—¦ãã®ã¾ã¾è¡¨ç¤º
                const { data: items } = await client.models.Event.list();
                
                // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
                items.sort((a, b) => new Date(b.date) - new Date(a.date));

                renderList(items);
            } catch (e) {
                console.error(e);
                listEl.textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
            }
        }

        // --- 2. æç”» ---
        function renderList(items) {
            if (items.length === 0) {
                listEl.innerHTML = '<p>ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            let html = '';
            items.forEach(item => {
                if(!item.date) return; // ä¸æ­£ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒƒãƒ—
                
                html += `
                    <div class="event-item">
                        <div>
                            <span style="color:var(--accent-gold); font-weight:bold;">${item.date}</span>
                            <span style="font-size:0.8rem; border:1px solid #666; padding:2px 5px; margin-left:10px; border-radius:3px;">${item.type}</span>
                            <h3 style="margin:5px 0 0 0; font-size:1.1rem;">${item.title}</h3>
                            <div style="font-size:0.8rem; opacity:0.7;">${item.time} / ${item.description}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteEvent('${item.id}')">å‰Šé™¤</button>
                    </div>
                `;
            });
            listEl.innerHTML = html;
        }

        // --- 3. è¿½åŠ å‡¦ç† ---
        async function addEvent() {
            const title = document.getElementById('inp-title').value;
            const type = document.getElementById('inp-type').value;
            const date = document.getElementById('inp-date').value;
            const time = document.getElementById('inp-time').value;
            const desc = document.getElementById('inp-desc').value;

            if (!title || !date) {
                alert("ã€Œã‚¤ãƒ™ãƒ³ãƒˆåã€ã¨ã€Œæ—¥ä»˜ã€ã¯å¿…é ˆã§ã™ï¼");
                return;
            }

            if (!confirm(`ä»¥ä¸‹ã®å†…å®¹ã§ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ\n\n${date} ${title}`)) return;

            try {
                await client.models.Event.create({
                    title: title,
                    type: type,
                    date: date,
                    time: time,
                    description: desc
                });
                
                alert("ç™»éŒ²ã—ã¾ã—ãŸï¼");
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('inp-title').value = "";
                document.getElementById('inp-desc').value = "";
                
                // ãƒªã‚¹ãƒˆå†èª­ã¿è¾¼ã¿
                fetchList();
                
            } catch (e) {
                console.error(e);
                alert("ç™»éŒ²ã‚¨ãƒ©ãƒ¼: " + e.message);
            }
        }

        // --- 4. å‰Šé™¤å‡¦ç† ---
        async function deleteEvent(id) {
            if (!confirm("æœ¬å½“ã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰")) return;

            try {
                await client.models.Event.delete({ id: id });
                alert("å‰Šé™¤ã—ã¾ã—ãŸã€‚");
                fetchList();
            } catch (e) {
                console.error(e);
                alert("å‰Šé™¤ã‚¨ãƒ©ãƒ¼: " + e);
            }
        }
    </script>
</body>
</html>